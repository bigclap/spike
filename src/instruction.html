<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<article id="article" class="prose mx-auto mt-8 max-w-3xl astro-vj4tpspi"> <p>Bringing your favorite front-end development stack to browser extension development isn't too complicated. Once you figured out all the gotchas.</p>
    <p>Many templates on GitHub don't offer a real cross-browser experience.</p>
    <p>They either use:</p>
    <ul>
        <li><p>Manifest V3 that Firefox does not yet support</p>
        </li>
        <li><p>Manifest V2. You can use it to build and test extensions for Chrome, but you can't publish them to the Chrome Web Store.</p>
        </li>
    </ul>
    <div class="embed-wrapper"><div class="embed-loading"><div class="loadingRow"></div><div class="loadingRow"></div></div><a class="embed-card" href="https://twitter.com/akoskm/status/1581223328001708032">https://twitter.com/akoskm/status/1581223328001708032</a></div>
    <p> </p>
    <p>I'm a Firefox user, but I know most of you use Chrome.</p>
    <p>Because I wanted my extension <a target="_blank" href="https://tweton.com">Tweton</a> to be available to wider audiences, I made it cross browser with the above tech stack.</p>
    <p>I'm sharing this tutorial so you can build proper cross-browser plugins that work with Manifest v2 and v3.</p>
    <p>If you'd like to support my work and you're interested in the "behind the scenes" of this blog, check out my free newsletter:</p>
    <div class="hn-embed-widget" id="substack"></div><p> </p>
    <p>Now let's get started!</p>
    <h2 id="heading-setup" class="group">Setup<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-setup"><span aria-hidden="true">#</span></a></h2>
    <p>This section will be your casual how-to-set-up Vite with React and TailwindCSS tutorial, if you will.</p>
    <p>Nothing in this section is specific to browser plugins.</p>
    <p>You can use it as a reference for your next plugins or web applications.</p>
    <h3 id="heading-create-a-vite-react-ts-project" class="group">Create a Vite + React + TS project<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-create-a-vite-react-ts-project"><span aria-hidden="true">#</span></a></h3>
    <p>The fastest way to get started with Vite for empty projects is to scaffold from a <code>react-ts</code> template.</p>
    <p>This template uses <a target="_blank" href="https://github.com/vitejs/vite/tree/main/packages/plugin-react">@plugin-react</a> for Vite.</p>
    <p>You don't have to worry about setting up TypeScript itself.</p>
    <p>The template supplies a default tsconfig.json and all the required dependencies in <code>package.json</code>.</p>
    <p>Open the command line and run:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-bash">$ npm create vite@latest vite-react-tailwindcss-extension -- --template react-ts
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>Run the command and enter the <code>vite-react-tailwindcss-extension</code> directory.</p>
    <p>Install the packages, and make sure the template application works:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-bash">$ npm i
$ npm run dev

&gt; vite-react-tailwindcss-extension@0.0.0 dev
&gt; vite


  VITE v3.2.3  ready <span class="hljs-keyword">in</span> 595 ms

  âžœ  Local:   http://127.0.0.1:5173/
  âžœ  Network: use --host to expose
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>If everything is setup correctly and you click the link in the command line or open it in your browser, you should see the scaffolded app that looks something like this:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668328291462/pvlkzwO-D.png" alt="Vite React + TypeScript template app"></p>
    <h3 id="heading-tailwindcss" class="group">TailwindCSS<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-tailwindcss"><span aria-hidden="true">#</span></a></h3>
    <p>Next, we're adding TailwindCSS. There's an official <a target="_blank" href="https://tailwindcss.com/docs/guides/vite">Vite-specific guide</a> I suggest you follow. I don't want to recite here the entire thing because the official docs are always up to date.</p>
    <p>Once you installed the necessary dependencies and adjusted the <code>tailwind.config.cjs</code> , the template paths, and added the TailwindCSS directives to <code>index.css</code> files, replace the contents of <code>src/App.tsx</code> with the following:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleClick</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// do nothing for now</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"App flex flex-col gap-4 h-screen items-center justify-center"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-5xl font-extrabold"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-violet-500"</span>&gt;</span>
          This is My First Browser Extensions!
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-2xl text-gray-800'</span>&gt;</span>
        Powered by Vite, React, TypeScript, and TailwindCSS
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"px-4 py-2 font-semibold text-sm bg-cyan-500 text-white rounded-full shadow-sm"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>Click me!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>If you run <code>npm run dev</code> again, you'll notice how the entire page has changed:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668409850036/zQagNW7Sa.png" alt=""></p>
    <p>You can delete <code>App.css</code> and everything from <code>index.css</code>.</p>
    <p>Leaving only the TailwindCSS directives:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-css"><span class="hljs-comment">/* src/index.css */</span>

<span class="hljs-keyword">@tailwind</span> base;
<span class="hljs-keyword">@tailwind</span> components;
<span class="hljs-keyword">@tailwind</span> utilities;
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>Our favorite front-end stack is ready!</p>
    <p>It's time to spice it up and turn this into a browser extension!</p>
    <h2 id="heading-creating-the-browser-extension-layout" class="group">Creating the Browser Extension Layout<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-creating-the-browser-extension-layout"><span aria-hidden="true">#</span></a></h2>
    <p>In this section, we're adding our first browser-plugin-specific files.</p>
    <p>In <a target="_blank" href="https://akoskm.com/building-a-cross-browser-extension#heading-scripts">my previous guide</a>, we were already talking about what these files are used for in browser plugins.</p>
    <p>But before, we're going to need a super important package:</p>
    <h3 id="heading-webextension-polyfill" class="group">webextension-polyfill<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-webextension-polyfill"><span aria-hidden="true">#</span></a></h3>
    <p>This package lets us use the <a target="_blank" href="https://www.w3.org/community/browserext/">standardized Browser Extension API</a> in Firefox and Chrome.</p>
    <p>To install the package and its typing, run:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript">npm i -D webextension-polyfill @types/webextension-polyfill
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>We will use this package in the background and the content script.</p>
    <h3 id="heading-popup-file" class="group">Popup file<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-popup-file"><span aria-hidden="true">#</span></a></h3>
    <p>First, start with the popup file. The popup is the UI you get when you click on the plugin's icon in the browser's toolbar.</p>
    <p>Create a <code>popup.html</code> file in the root of your project directory, next to <code>package.json</code>:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vite + React + TS + TailwindCSS<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Vite + React + TS + TailwindCSS<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <h3 id="heading-background-files" class="group">Background files<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-background-files"><span aria-hidden="true">#</span></a></h3>
    <p>This is where we first run into browser-specific, more precisely, Manifest-specific conventions.</p>
    <p><strong>background.html</strong></p>
    <p>In Manifest v2, the way how you define the background script is through a particular HTML page. The sole purpose of this page is to import the background script.</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vite + React + TS<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./background.ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>Later, when we add our browser-specific Manifest files, you'll see that Chrome doesn't need this file.</p>
    <p>This is because Manifest V3 uses service workers.</p>
    <p><strong>background.ts</strong></p>
    <p>Let's keep the background file simple for now:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript"><span class="hljs-keyword">import</span> browser <span class="hljs-keyword">from</span> <span class="hljs-string">"webextension-polyfill"</span>;

browser.runtime.onMessage.addListener(<span class="hljs-function">(<span class="hljs-params">msg, sender, response</span>) =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'message received from content script: '</span>, msg);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
});
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>Note the <code>webextension-polyfill</code> import, the package we installed earlier.</p>
    <h3 id="heading-content-script" class="group">Content Script<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-content-script"><span aria-hidden="true">#</span></a></h3>
    <p>Content Script runs in the context of a particular web page and can directly access the contents of that page.</p>
    <p>This can be useful if you want to make a plugin that interacts with the website's contents, such as Grammarly or <a target="_blank" href="https://tweton.com">Tweton</a>.</p>
    <p>In this example, our main UI will render inside the web page, similar to the above two plugins.</p>
    <p>To create a better separation, I suggest you create a new directory <code>content-scripts</code> where you'll place your content script files.</p>
    <p>Move <code>src/index.tsx</code> and <code>src/index.css</code> files there.</p>
    <p>Change the contents of <code>src/index.tsx</code> to:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript"><span class="hljs-comment">// src/content-script/index.tsx</span>
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>
<span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./index.css'</span>

<span class="hljs-keyword">const</span> index = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>)
index.id = <span class="hljs-string">'extension-root'</span>;

<span class="hljs-keyword">const</span> body = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'body'</span>)
<span class="hljs-keyword">if</span> (body) {
  body.prepend(index)
}

ReactDOM.createRoot(index).render(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.StrictMode</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">React.StrictMode</span>&gt;</span></span>
)
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>This snippet is close to what we originally had.</p>
    <p>The only different thing is that with traditional React apps, you would create an empty <code>index.html</code> page with a <code>&lt;div id="root"&gt;&lt;/div&gt;</code> and use something like this to get the app rendered:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript">ReactDOM.render(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.StrictMode</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">React.StrictMode</span>&gt;</span></span>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>)
);
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>In the case of content scripts, you can target any part of the current webpage and render your entire React app there!</p>
    <p>Finally, update the <code>handleClick</code> function in <code>content-script/App.tsx</code>:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript"><span class="hljs-keyword">import</span> browser <span class="hljs-keyword">from</span> <span class="hljs-string">"webextension-polyfill"</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleClick</span> (<span class="hljs-params"></span>) </span>{
 browser.runtime.sendMessage({ <span class="hljs-attr">action</span>: <span class="hljs-string">'Hi from content script ðŸ‘‹'</span> });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>{
 <span class="hljs-keyword">return</span> (
<span class="hljs-comment">// the rest is unchanged</span>
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>With the new handler, clicking the button will send an object to your background script!</p>
    <h2 id="heading-creating-the-browser-manifest-files" class="group">Creating the Browser Manifest Files<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-creating-the-browser-manifest-files"><span aria-hidden="true">#</span></a></h2>
    <p>At this point, we have all the JavaScript files that a browser plugin will need.</p>
    <p>It's time to describe how the browser will use these files.</p>
    <p>Remember the differences from our <a target="_blank" href="https://akoskm.com/building-a-cross-browser-extension#heading-manifest-v2-vs-v3">previous post</a> between different Manifest versions?</p>
    <p>Because of this, we need two manifest files.</p>
    <p>Manifest V2 for Firefox.</p>
    <p>Manifest V3 for Chrome and other Chromium-based browsers.</p>
    <h3 id="heading-firefox" class="group">Firefox<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-firefox"><span aria-hidden="true">#</span></a></h3>
    <p>Let's create a <code>manifest.json</code> in the <code>public/</code> folder:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-json"><span class="hljs-comment">// public/manifest.json</span>
{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Vite/React/TailwindCSS Plugin"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A Cross Borwser Template for Firefox"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"manifest_version"</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">"browser_action"</span>: {
    <span class="hljs-attr">"default_popup"</span>: <span class="hljs-string">"popup.html"</span>,
    <span class="hljs-attr">"default_title"</span>: <span class="hljs-string">"Open the popup"</span>
  },
  <span class="hljs-attr">"optional_permissions"</span>: [
    <span class="hljs-string">"&lt;all_urls&gt;"</span>
  ],
  <span class="hljs-attr">"content_scripts"</span>: [
    {
      <span class="hljs-attr">"matches"</span>: [
        <span class="hljs-string">"https://blank.org/*"</span>
      ],
      <span class="hljs-attr">"run_at"</span>: <span class="hljs-string">"document_end"</span>,
      <span class="hljs-attr">"js"</span>: [
        <span class="hljs-string">"./index.global.js"</span>
      ],
      <span class="hljs-attr">"css"</span>: [
        <span class="hljs-string">"./style.css"</span>
      ]
    }
  ],
  <span class="hljs-attr">"background"</span>: {
    <span class="hljs-attr">"page"</span>: <span class="hljs-string">"background.html"</span>,
    <span class="hljs-attr">"persistent"</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-attr">"icons"</span>: {
    <span class="hljs-attr">"128"</span>: <span class="hljs-string">"vite.svg"</span>
  }
}
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>Here are the key fields:</p>
    <p><code>"default_popup": "popup.html",</code> As you probably guessed, this is the location of the popup file.</p>
    <p><code>"content_scripts"</code> describes four essential things:</p>
    <ul>
        <li><p><code>matches</code> - this is the URL that the content script can access.</p>
        </li>
        <li><p><code>js</code> and <code>css</code> - the respective files injected into the pages matched by <code>matches</code></p>
        </li>
        <li><p><code>run_at</code> - determines where the JS and CSS files are injected.</p>
        </li>
    </ul>
    <h3 id="heading-chrome" class="group">Chrome<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-chrome"><span aria-hidden="true">#</span></a></h3>
    <p>Time to create the Manifest V3 for Chrome:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-json"><span class="hljs-comment">// public/manifestv3.json</span>
{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Vite/React/TailwindCSS Plugin"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A Cross Borwser Template for Firefox"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"manifest_version"</span>: <span class="hljs-number">3</span>,
  <span class="hljs-attr">"action"</span>: {
    <span class="hljs-attr">"default_popup"</span>: <span class="hljs-string">"popup.html"</span>,
    <span class="hljs-attr">"default_title"</span>: <span class="hljs-string">"Open the popup"</span>
  },
  <span class="hljs-attr">"content_scripts"</span>: [
    {
      <span class="hljs-attr">"matches"</span>: [
        <span class="hljs-string">"https://blank.org/*"</span>
      ],
      <span class="hljs-attr">"run_at"</span>: <span class="hljs-string">"document_end"</span>,
      <span class="hljs-attr">"js"</span>: [
        <span class="hljs-string">"./index.global.js"</span>
      ],
      <span class="hljs-attr">"css"</span>: [
        <span class="hljs-string">"./style.css"</span>
      ]
    }
  ],
  <span class="hljs-attr">"permissions"</span>: [
    <span class="hljs-string">"storage"</span>
  ],
  <span class="hljs-attr">"background"</span>: {
    <span class="hljs-attr">"service_worker"</span>: <span class="hljs-string">"./background.global.js"</span>
  },
  <span class="hljs-attr">"icons"</span>: {
    <span class="hljs-attr">"128"</span>: <span class="hljs-string">"logo128.png"</span>
  }
}
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>This is pretty much the same file for the most part:</p>
    <p><code>browser-action</code> is <code>action</code> , <code>content_scripts</code> stays the same.</p>
    <p>The only key difference is in the <code>background</code> section.</p>
    <p>If you remember, when we were talking about the Background files, we mentioned that Manifest v3 uses service workers instead of specific HTML pages to inject the background scripts.</p>
    <p>Manifest V3 does not need the <code>background.html</code> page. You can reference the background script directly from the Manifest file.</p>
    <h2 id="heading-build-scripts" class="group">Build scripts<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-build-scripts"><span aria-hidden="true">#</span></a></h2>
    <h3 id="heading-vite-tweaks" class="group">Vite tweaks<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-vite-tweaks"><span aria-hidden="true">#</span></a></h3>
    <p>Because the content script does not support ESM and Vite bundles to ESM by default, we have to make some adjustments here.</p>
    <p>Let's start by creating a <code>vite.content.config.ts</code> file.</p>
    <p>Here we tell Vite to turn our contents-scripts files into an IIFE bundle:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript"><span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig({
  <span class="hljs-attr">plugins</span>: [react()],
  <span class="hljs-attr">define</span>: {
    <span class="hljs-string">'process.env'</span>: {}
  },
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">emptyOutDir</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">outDir</span>: resolve(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">lib</span>: {
      <span class="hljs-attr">formats</span>: [<span class="hljs-string">'iife'</span>],
      <span class="hljs-attr">entry</span>: resolve(__dirname, <span class="hljs-string">'./content-script/index.tsx'</span>),
      <span class="hljs-attr">name</span>: <span class="hljs-string">'Vite/React/TailwindCSS Plugin'</span>
    },
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'index.global.js'</span>,
        <span class="hljs-attr">extend</span>: <span class="hljs-literal">true</span>,
      }
    }
  }
})
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>We can bundle the popup and the background files without this restriction. This config file becomes a lot simpler:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig({
  <span class="hljs-attr">plugins</span>: [react()],
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">outDir</span>: <span class="hljs-string">'dist'</span>,
    <span class="hljs-attr">emptyOutDir</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">index</span>: <span class="hljs-keyword">new</span> URL(<span class="hljs-string">'./popup.html'</span>, <span class="hljs-keyword">import</span>.meta.url).pathname,
        <span class="hljs-attr">background</span>: <span class="hljs-keyword">new</span> URL(<span class="hljs-string">'./background.html'</span>, <span class="hljs-keyword">import</span>.meta.url).pathname,
      }
    }
  }
})
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <h3 id="heading-background-script-bundling-for-chrome" class="group">Background Script bundling for Chrome<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-background-script-bundling-for-chrome"><span aria-hidden="true">#</span></a></h3>
    <p>If you remember from the previous section, Chrome uses service workers instead of <code>background.html</code> for background files.</p>
    <p>To bundle our <code>background.ts</code> file into a single <code>background.global.js</code> we'll add another Vite config file:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig({
  <span class="hljs-attr">plugins</span>: [react()],
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">emptyOutDir</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">outDir</span>: resolve(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">lib</span>: {
      <span class="hljs-attr">formats</span>: [<span class="hljs-string">'iife'</span>],
      <span class="hljs-attr">entry</span>: resolve(__dirname, <span class="hljs-string">'./background.ts'</span>),
      <span class="hljs-attr">name</span>: <span class="hljs-string">'Vite/React/TailwindCSS Plugin'</span>
    },
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'background.global.js'</span>,
        <span class="hljs-attr">extend</span>: <span class="hljs-literal">true</span>,
      }
    }
  }
})
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <h3 id="heading-scripts" class="group">Scripts<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-scripts"><span aria-hidden="true">#</span></a></h3>
    <p>Let's add some handy scripts to out <code>package.json</code>:</p>
    <div style="position: relative;"><pre tabindex="0"><code class="lang-javascript"><span class="hljs-string">"build:manifest:chrome"</span>: <span class="hljs-string">"mv dist/manifestv3.json dist/manifest.json"</span>,
<span class="hljs-string">"build:background:chrome"</span>: <span class="hljs-string">"vite build --config vite.chrome.background.config.ts"</span>,
<span class="hljs-string">"build:js"</span>: <span class="hljs-string">"vite build --config vite.content.config.ts"</span>,
<span class="hljs-string">"build:web"</span>: <span class="hljs-string">"tsc &amp;&amp; vite build"</span>,
<span class="hljs-string">"build"</span>: <span class="hljs-string">"NODE_ENV=production run-s build:js build:web"</span>,
<span class="hljs-string">"build:chrome"</span>: <span class="hljs-string">"NODE_ENV=production run-s build:js build:background:chrome build:web build:manifest:chrome"</span>,
</code><button class="copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium">Copy</button></pre></div>
    <p>I'm using <code>npm-run-all</code> so I can chain together npm commands without putting &amp;&amp; in between them. It's optional.</p>
    <p>Try running <code>npm run build</code>.</p>
    <p>If you did everything right, you should see <code>dist/index.global.js</code> and the <code>dist/style.css</code> files from our content script bundling.</p>
    <p>The bundling of the popup and background files should have resulted <code>dist/popup.html</code> and in <code>dist/assets/background.&lt;some hash&gt;.js</code> that's referenced from <code>dist/background.html</code> .</p>
    <p>To bundle the extensions for Chrome run <code>npm run build:chrome</code>. The only difference is that our <code>dist</code> folder will also contain a <code>dist/background.global.js</code> file that Chrome's Manifest V3 uses.</p>
    <h2 id="heading-testing-in-firefox" class="group">Testing in Firefox<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-testing-in-firefox"><span aria-hidden="true">#</span></a></h2>
    <p>In Firefox, open preferences from the menu or enter <code>about:preferences</code> in the address bar.</p>
    <p>Go to <code>Extensions &amp; Themes</code>, and click the little gear icon in the upper right corner.</p>
    <p>Select Debug Add-ons:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668404201874/zopSbsNoR.png" alt=""></p>
    <p>On the next screen, click Load Temporary Add-on and locate the directory where your <code>dist/</code> is located:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668404311710/NxKR0UGIS.png" alt=""></p>
    <p>select the <code>manifest.json</code> file and click Open.</p>
    <p>It should appear under Temporary Extensions:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668405845535/IU2o2SYyt.png" alt=""></p>
    <h3 id="heading-content-script-1" class="group">Content Script<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-content-script-1"><span aria-hidden="true">#</span></a></h3>
    <p>Navigate to <a target="_blank" href="https://blank.org">https://blank.org</a>, and you should see your extension injected inside the page:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668406286158/F2IaUJnAA.png" alt=""></p>
    <h3 id="heading-popup" class="group">Popup<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-popup"><span aria-hidden="true">#</span></a></h3>
    <p>The extension icon should automatically appear after installation in your extension area:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668412587105/fNSKDWhQy.gif" alt=""></p>
    <h3 id="heading-background" class="group">Background<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-background"><span aria-hidden="true">#</span></a></h3>
    <p>To test the background script, go back to Temporary Extensions and click the Inspect button next to the addon's name. A debug panel will pop up.</p>
    <p>Switch back to blank.org and click the button:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668412701173/n8-zszD_2.gif" alt=""></p>
    <p>Similar to the above recording, <code>{ action: 'Hi from content script ðŸ‘‹' }</code> should appear in the console of the background script.</p>
    <h2 id="heading-testing-in-chrome" class="group">Testing in Chrome<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-testing-in-chrome"><span aria-hidden="true">#</span></a></h2>
    <p>Type <code>chrome://extensions/</code> in the browser's search bar and click Load unpacked:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668406531404/0ON4MK8cs.png" alt=""></p>
    <h3 id="heading-content-script-2" class="group">Content script<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-content-script-2"><span aria-hidden="true">#</span></a></h3>
    <p>Navigate again to <a target="_blank" href="https://blank.org">https://blank.org</a> and make sure the extension is running:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668407079729/mEqzFA4Tj.png" alt=""></p>
    <h3 id="heading-popup-1" class="group">Popup<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-popup-1"><span aria-hidden="true">#</span></a></h3>
    <p>Let's check our popup page as well! Click the ðŸ§© icon, find the <strong>Vite/React/TailwindCSS Plugin</strong>, pin it to the toolbar, and click it.</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668407146996/0Dy_oWA50.png" alt=""></p>
    <h3 id="heading-background-1" class="group">Background<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-background-1"><span aria-hidden="true">#</span></a></h3>
    <p>To check the background script, go back to the extensions page <code>chrome://extensions/</code> and click the <em>service worker</em> link:</p>
    <p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1668412807689/WauVf2ahK.gif" alt=""></p>
    <p>It already contains the <code>{ action: 'Hi from content script ðŸ‘‹' }</code> message because I already clicked the button before I clicked the <em>service worker</em> link, but you get the idea.</p>
    <h2 id="heading-github-repository-template" class="group">GitHub repository template<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-github-repository-template"><span aria-hidden="true">#</span></a></h2>
    <p><a target="_blank" href="https://github.com/akoskm/vite-react-tailwindcss-browser-extension-simple">https://github.com/akoskm/vite-react-tailwindcss-browser-extension-simple</a></p>
    <h2 id="heading-whats-next" class="group">What's next?<a class="heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100" href="#heading-whats-next"><span aria-hidden="true">#</span></a></h2>
    <p>Well, first of all: <strong>Congratulations!</strong></p>
    <p>Building cross-browser extensions isn't a simple task.</p>
    <p>Enjoy the fruit of your hard work, and try to tweak the extension a bit.</p>
    <p>Things you could try out:</p>
    <ul>
        <li><p>create a floating extension that stays in the top-left corner of every page</p>
        </li>
        <li><p>an extension that attaches to a specific element inside your blog</p>
        </li>
        <li><p>build a sticky note-taking app</p>
        </li>
    </ul>
    <p>But you might ask - how do we save the notes?</p>
    <p>That's what we're going to solve in our next blog post!</p>
</article>
</body>
</html>
